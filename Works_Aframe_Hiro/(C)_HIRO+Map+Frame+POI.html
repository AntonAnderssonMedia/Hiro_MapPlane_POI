<!DOCTYPE html>
<html>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <!-- keep your exact AR.js include since this build works for you -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <body style="margin:0; overflow:hidden;">

    <a-scene embedded arjs>
      <a-entity light="type: hemisphere; intensity: 1"></a-entity>

      <a-assets timeout="30000" crossorigin="anonymous">
        <img id="map" src="https://cdn.jsdelivr.net/gh/AntonAnderssonMedia/Camera_HiroModel@main/red-map-frame.png">
        <!-- POI icon -->
        <img id="poi" src="https://cdn.jsdelivr.net/gh/AntonAnderssonMedia/Camera_HiroModel@main/POI_circle.png">
      </a-assets>

      <a-marker preset="hiro" emitevents="true" id="marker">
        <!-- red frame overlay (your existing plane) -->
        <a-plane id="mapPlane"
                 src="#map"
                 position="0 0 0"
                 rotation="-90 0 0"
                 width="1" height="1"
                 material="transparent:true; side: double;"
                 visible="false"></a-plane>

        <!-- POI as PNG, flat on the map -->
        <a-image id="poiDot"
                 src="#poi"
                 rotation="-90 0 0"
                 width="0.12" height="0.12"
                 position="0 0.01 0"
                 visible="false"></a-image>

        <!-- Optional: thin SWEREF outline square (helps verify bounds) -->
        <a-entity id="swerefOutline" visible="false">
          <!-- we’ll size + place these in JS once we know W×H -->
          <a-box id="edgeL" color="#FF0000" height="0.002" depth="1" width="0.02" position="0 0 0"></a-box>
          <a-box id="edgeR" color="#FF0000" height="0.002" depth="1" width="0.02" position="0 0 0"></a-box>
          <a-box id="edgeT" color="#FF0000" height="0.002" depth="0.02" width="1" position="0 0 0"></a-box>
          <a-box id="edgeB" color="#FF0000" height="0.002" depth="0.02" width="1" position="0 0 0"></a-box>
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const marker = document.getElementById('marker');
      const plane  = document.getElementById('mapPlane');
      const img    = document.getElementById('map');
      const poiDot = document.getElementById('poiDot');
      const outline= document.getElementById('swerefOutline');
      const edgeL  = document.getElementById('edgeL');
      const edgeR  = document.getElementById('edgeR');
      const edgeT  = document.getElementById('edgeT');
      const edgeB  = document.getElementById('edgeB');

      // ---- SWEREF 99 TM bounds of your printed map (meters) ----
      const eastMin  = 565000;
      const eastMax  = 575000;
      const northMax = 6500000;  // top
      const northMin = 6490000;  // bottom

      // POI: Vaxkupan (SWEREF 99 TM)
      const poi = { north: 6495019, east: 569026 };

      // same scale as your working code
      const markerSize = 1;       
      const scaleFactor = 3.5;    

      function swerefToUV(north, east, W, H){
        const u = (east  - eastMin)  / (eastMax  - eastMin)  * W;      // right
        const v = (northMax - north) / (northMax - northMin) * H;      // down
        return [u, v];
      }

      img.addEventListener('load', () => {
        // keep your aspect logic → compute plane width/height
        const ar = img.naturalWidth / img.naturalHeight;
        let W, H;
        if (ar >= 1) { W = markerSize * scaleFactor; H = (markerSize / ar) * scaleFactor; }
        else         { W = (markerSize * ar) * scaleFactor; H = markerSize * scaleFactor; }

        plane.setAttribute('width',  W);
        plane.setAttribute('height', H);
        // top-left of the plane at marker origin; tiny lift to avoid z-fighting
        plane.setAttribute('position', `${W/2} 0.002 ${H/2}`);

        // place the POI PNG by SWEREF
        const [u, v] = swerefToUV(poi.north, poi.east, W, H);
        poiDot.setAttribute('position', `${u} 0.01 ${v}`);

      });

      // show/hide when marker is visible
      marker.addEventListener('markerFound', () => {
        plane.setAttribute('visible', true);
        poiDot.setAttribute('visible', true);
        outline.setAttribute('visible', true); // toggle off if you don’t want the extra outline
      });
      marker.addEventListener('markerLost', () => {
        plane.setAttribute('visible', false);
        poiDot.setAttribute('visible', false);
        outline.setAttribute('visible', false);
      });
    </script>
  </body>
</html>
